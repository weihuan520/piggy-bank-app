<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FF6B9D">
    <meta name="description" content="可爱记账 - 小猪存钱罐，简单好用的个人记账应用">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="小猪记账">
    <title>可爱记账 - 小猪存钱罐</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>
    <div class="app-container">
        <!-- 顶部导航 -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="pig-icon">🐷</span>
                    <h1>小猪记账</h1>
                </div>
                <div class="date-display" id="currentDate"></div>
            </div>
            <div class="header-decoration">
                <div class="cloud cloud-1">☁️</div>
                <div class="cloud cloud-2">☁️</div>
            </div>
        </header>

        <!-- 余额卡片 -->
        <section class="balance-card">
            <div class="balance-content">
                <p class="balance-label">💎 我的余额</p>
                <h2 class="balance-amount" id="totalBalance">¥0.00</h2>
                <div class="balance-stats">
                    <div class="stat-item">
                        <span class="stat-icon income">💰</span>
                        <div>
                            <p class="stat-label">收入</p>
                            <p class="stat-value income" id="totalIncome">¥0.00</p>
                        </div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon expense">💸</span>
                        <div>
                            <p class="stat-label">支出</p>
                            <p class="stat-value expense" id="totalExpense">¥0.00</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-decoration">
                <div class="circle circle-1"></div>
                <div class="circle circle-2"></div>
                <div class="circle circle-3"></div>
                <div class="star star-1">⭐</div>
                <div class="star star-2">✨</div>
            </div>
        </section>

        <!-- 快捷操作 -->
        <section class="quick-actions">
            <button class="action-btn income-btn" onclick="openModal('income')" aria-label="记收入">
                <span class="btn-icon">💵</span>
                <span>记收入</span>
            </button>
            <button class="action-btn expense-btn" onclick="openModal('expense')" aria-label="记支出">
                <span class="btn-icon">🛒</span>
                <span>记支出</span>
            </button>
        </section>

        <!-- 记账列表 -->
        <section class="transactions-section">
            <div class="section-header">
                <h3>📝 记账明细</h3>
                <button class="filter-btn" onclick="toggleFilter()" aria-label="筛选记账">
                    <span id="filterText">全部</span>
                    <span class="arrow">▼</span>
                </button>
            </div>
            <div class="filter-options" id="filterOptions" style="display: none;">
                <button class="filter-option active" data-filter="all" onclick="filterTransactions('all')">全部</button>
                <button class="filter-option" data-filter="income" onclick="filterTransactions('income')">收入</button>
                <button class="filter-option" data-filter="expense" onclick="filterTransactions('expense')">支出</button>
            </div>
            <div class="transactions-list" id="transactionsList">
                <div class="empty-state">
                    <span class="empty-icon">🐽</span>
                    <p>还没有记账哦~</p>
                    <p class="empty-hint">点击上方按钮开始记账吧！</p>
                </div>
            </div>
        </section>

        <!-- 底部导航 -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="switchTab('home')">
                <span class="nav-icon">🏠</span>
                <span>首页</span>
            </button>
            <button class="nav-item" onclick="switchTab('stats')">
                <span class="nav-icon">📊</span>
                <span>统计</span>
            </button>
            <button class="nav-item" onclick="switchTab('settings')">
                <span class="nav-icon">⚙️</span>
                <span>设置</span>
            </button>
        </nav>
    </div>

    <!-- 记账弹窗 -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal()" role="dialog" aria-modal="true">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modalTitle">记一笔</h3>
                <button class="close-btn" onclick="closeModal()" aria-label="关闭">✕</button>
            </div>
            <form class="modal-form" id="transactionForm">
                <input type="hidden" id="transactionType" value="expense">
                
                <div class="form-group">
                    <label for="amount">💰 金额</label>
                    <div class="amount-input">
                        <span class="currency">¥</span>
                        <input type="number" id="amount" name="amount" placeholder="0.00" step="0.01" required inputmode="decimal">
                    </div>
                </div>

                <div class="form-group">
                    <label>🏷️ 分类</label>
                    <div class="category-grid" id="categoryGrid" role="radiogroup">
                        <!-- 分类选项将通过JS动态生成 -->
                    </div>
                </div>

                <div class="form-group">
                    <label for="note">📝 备注 <span class="note-count">(0/50)</span></label>
                    <input type="text" id="note" name="note" placeholder="写点什么..." maxlength="50" oninput="updateNoteCount(this)">
                </div>

                <div class="form-group">
                    <label for="date">📅 日期</label>
                    <input type="date" id="date" name="date" required>
                </div>

                <button type="submit" class="submit-btn">
                    <span>💾</span>
                    保存记账
                </button>
            </form>
        </div>
    </div>

    <!-- 统计页面 -->
    <div class="page" id="statsPage" style="display: none;">
        <header class="header">
            <div class="header-content">
                <h1>📊 统计分析</h1>
            </div>
        </header>
        <section class="stats-content">
            <div class="stats-card">
                <h3>📅 本月支出</h3>
                <p class="stats-amount" id="monthlyExpense">¥0.00</p>
                <div class="stats-hint">继续加油，控制支出哦~ 💪</div>
            </div>
            <div class="category-stats" id="categoryStats">
                <div class="empty-state">
                    <span class="empty-icon">📈</span>
                    <p>暂无数据</p>
                    <p class="empty-hint">开始记账后就能看到统计啦~</p>
                </div>
            </div>
        </section>
    </div>

    <!-- 设置页面 -->
    <div class="page" id="settingsPage" style="display: none;">
        <header class="header">
            <div class="header-content">
                <h1>⚙️ 设置</h1>
            </div>
        </header>
        <section class="settings-content">
            <div class="settings-item">
                <span>🗑️ 清空所有数据</span>
                <button class="danger-btn" onclick="clearAllData()">清空</button>
            </div>
            <div class="settings-item">
                <span>📤 导出数据</span>
                <button class="primary-btn" onclick="exportData()">导出</button>
            </div>
            <div class="settings-info">
                <p>💡 提示：数据保存在本地浏览器中</p>
                <p>🔒 隐私保护：您的数据不会上传到服务器</p>
            </div>
        </section>
    </div>

    <!-- Toast 提示容器 -->
    <div id="toastContainer" role="alert" aria-live="polite"></div>

    <script>
        // 注册 Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('Service Worker 注册成功:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker 注册失败:', error);
                    });
            });
        }
    </script>
    <script src="app.js"></script>
</body>
</html>
